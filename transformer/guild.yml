bash:
  description: GuildAI test
  exec: ./run-me.sh -s ${src} -t ${tgt} --gpus ${gpus} -v ${voc_sz} -r ${ratio}
  sourcecode:
    - 'scripts/'
    - 'run-me.sh'
    - 'config.yml'
    - exclude:
      - 'model/'
      - 'valid_output/'
  requires:
    - file: config.yml
    - file: 'run-me.sh'
    - file: 'scripts/'
    - file: '../tools/'

  flags:
    src: en
    tgt: fr
    voc_sz: 32000
    ratio: null
    gpus: 0

    learn-rate: 0.0003
    type: transformer
    enc-depth: 1
    dec-depth: 1
    transformer-heads: 8
    transformer-postprocess-emb: d
    transformer-postprocess: dan
    transformer-dropout: 0.1
    beam-size: 6
    normalize: 0.6

    after-epochs: 50
    cost-type: ce-mean-words

    learn-rate: 0.0003
    exponential-smoothing: true
    lr-warmup: 16000
    lr-decay-inv-sqrt: 16000
    lr-report: true
    clip-norm: 5
    label-smoothing: 0.1
    tied-embeddings-all: true
    sync-sgd: true
    disp-freq: 500

    max-length: 100
    mini-batch-fit: true
    maxi-batch: 10000

    valid-freq: 1000
    valid-mini-batch: 64

  output-scalars:
    - nlines: 'n_lines: (\value)'
    - BLEU: 'BLEU[\S+]* = (\value)'
    - step: 'Starting epoch (\step)'
    - ': (\key) : (\value) :'
    - ': (\key) (\value) :'
    - time: 'Time (\value)s'
    - lr: 'L.r. (\value)'

  stoppable: true
